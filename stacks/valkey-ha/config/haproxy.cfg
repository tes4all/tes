global
    log stdout format raw local0

defaults
    log     global
    mode    tcp
    option  tcplog
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms

frontend valkey_frontend
    bind *:6379
    default_backend valkey_backend

backend valkey_backend
    mode tcp
    # Health check for Valkey/Redis to find master
    option tcp-check
    tcp-check send PING\r\n
    tcp-check expect string +PONG
    tcp-check send info\ replication\r\n
    tcp-check expect string role:master

    server valkey-1 valkey-1:6379 check inter 1s
    server valkey-2 valkey-2:6379 check inter 1s
    server valkey-3 valkey-3:6379 check inter 1s

frontend sentinel_frontend
    bind *:26379
    default_backend sentinel_backend

backend sentinel_backend
    mode tcp
    server sentinel-1 sentinel-1:26379 check inter 1s
    server sentinel-2 sentinel-2:26379 check inter 1s
    server sentinel-3 sentinel-3:26379 check inter 1s
